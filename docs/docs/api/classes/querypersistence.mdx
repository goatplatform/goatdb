---
title: QueryPersistence
sidebar_label: QueryPersistence
---

# QueryPersistence

Manages persistence of query results across sessions.

QueryPersistence handles caching and storing query results to improve performance
and enable offline access. It maintains a cache of query results in memory and
periodically flushes them to persistent storage.

## Constructor

**<code>new QueryPersistence(storage: [QueryPersistenceStorage](/api/interfaces/querypersistencestorage))</code>**

Creates a new QueryPersistence instance.

## Methods

### close()

**<code>close(): void</code>**

Stops the periodic flush timer.

### closeRepo()

**<code>closeRepo(repoId: string): Promise&lt;void&gt;</code>**

Closes a repository and clears all related caches and pending operations.
Waits for any in-progress flushes to finish before clearing state.

### flush()

**<code>flush(repoId: string): Promise&lt;void&gt;</code>**

Flushes cached query results for a repository to storage.

### flushAll()

**<code>flushAll(): Promise&lt;void&gt;</code>**

Flushes all cached query results to storage.

### get()

**<code>get(repoId: string, queryId: string): Promise&lt;[QueryCache](/api/interfaces/querycache)&gt;</code>**

Retrieves cached query results for a repository and optional query ID.

### register()

**<code>register(query: [Query](/api/classes/query)&lt;[Schema](/api/types/schema), [Schema](/api/types/schema), [ReadonlyJSONValue](/api/types/readonlyjsonvalue)&gt;): void</code>**

Registers a query for persistence.

### repoExists()

**<code>repoExists(repoId: string): boolean</code>**

Checks if any caches or state exist for a given repo.
Returns true if any internal maps have entries for the repo.

### start()

**<code>start(): void</code>**

Starts the periodic flush timer.

### unregister()

**<code>unregister(query: [Query](/api/classes/query)&lt;[Schema](/api/types/schema), [Schema](/api/types/schema), [ReadonlyJSONValue](/api/types/readonlyjsonvalue)&gt;): void</code>**

Unregisters a query from persistence.

